---
layout: false
hidden: true
---

- files = ['index.html']
- title = "#{data.course.number}: #{data.course.title}"
- description = data.course.description.gsub(/\n/,"\\n")
- primary_color = data.course.primary_color
- secondary_color = data.course.secondary_color

!!! 5
%html{lang: "en"}
	%head
		%meta{ charset: "utf-8"}
		/ Open Graph Stuff
		%meta{ property: "og:locale", content: "en_US" }
		%meta{ property: "og:url", content: "#{data.course.url}#{current_page.url}" }
		%meta{ property: "og:description", :content=> description }
		%meta{ property: "og:title", content: title}
		%meta{ property: "og:site_name", content: title }
		%meta{ property: "og:type", content: "website" }
		
		/ Twitter Card Stuff
		%meta{ name: "twitter:card", content: "summary" }
		%meta{ name: "twitter:description", :content=> description }
		%meta{ name: "twitter:title", content: title }
		
		-# Always force latest IE rendering engine (even in intranet) & Chrome Frame
		-# Remove this if you use the .htaccess
		%meta{ "http-equiv" => "X-UA-Compatible", :content => "IE=edge,chrome=1" }/
		%meta{ name: "viewport", content: "width=device-width, initial-scale=1.0, minimum-scale=1.0"}
		%meta{ name: "description", content: description}
		%title= title
		=stylesheet_link_tag "https://fonts.googleapis.com/css?family=Roboto:regular,bold,italic,thin,light,bolditalic,black,medium&amp;lang=en", "https://fonts.googleapis.com/icon?family=Material+Icons", "https://code.getmdl.io/1.2.0/material.#{primary_color}-#{secondary_color}.min.css", "styles"
		:scss
			@import "mdl-utils/mdl-colors";
			$primary_color: "#{primary_color.gsub(/_/,"-")}";
			$secondary_color: "#{secondary_color.gsub(/_/,"-")}";
			
			p, ol, ul {
				font-size: 16px;
				&, h6 {
					line-height: 26px;
				}
			}
			h1, h2, h3, h4, h5, h6 {
				small {
					display: block;
					opacity: 1.0;
				}
			}
			
			a {
				color: color($secondary_color, "accent-4");
				&:hover {
					color: color($secondary_color, "accent-3");
				}
			}
			
			body {
				display: flex;
			    min-height: 100vh;
			    flex-direction: column;
				background-color: rgb(238, 238, 238);
			}
			main {
				flex: 1 0 auto;
			}
			
			.demo-ribbon {
			  width: 100%;
			  height: 40vh;
			  background-color: color($primary_color, "darken-1");
			  -webkit-flex-shrink: 0;
			      -ms-flex-negative: 0;
			          flex-shrink: 0;
			}

			.demo-main {
			  margin-top: -35vh;
			  -webkit-flex-shrink: 0;
			      -ms-flex-negative: 0;
			          flex-shrink: 0;
			}

			.demo-header .mdl-layout__header-row {
			  padding-left: 40px;
			}

			.demo-container {
			  max-width: 1600px;
			  width: calc(100% - 16px);
			  margin: 0 auto;
			}

			.demo-content {
			  border-radius: 2px;
			  padding: 80px 56px;
			  margin-bottom: 80px;
			}

			.demo-layout {
				background: color($primary_color, "lighten-5")
			}

			.demo-layout.is-small-screen .demo-content {
			  padding: 40px 28px;
			}

			.demo-content h3 {
			  margin-top: 48px;
			}

			.demo-footer {
			  padding-left: 40px;
			}

			.demo-footer .mdl-mini-footer--link-list a {
			  font-size: 13px;
			}
			.mdl-data-table {
				font-size: 14px;
				margin: auto;
				&--wide {
					width: 80%;
				}
			}
			@media print {
				.demo-content {
					padding-top: 0;
					padding-bottom: 0;
				}
				p,ol,ul {
					font-size: 14px;
					line-height: 1.2;
				}
				h1,h2,h3,h4,h5,h6 {
					margin-top: 16px !important;
					margin-bottom: 0;
					line-height: 1.25;
				}
				h1 {
					font-size: 36px;
				}
				h2 {
					font-size: 24px;
				}
				h3 {
					font-size: 18px;
				}
			}
	%body
		.demo-layout.mdl-layout.mdl-layout--fixed-header.mdl-js-layout
			.demo-ribbon
			%main.demo-main.mdl-layout__content
				.demo-container.mdl-grid
					.mdl-cell.mdl-cell--2-col.mdl-cell--hide-tablet.mdl-cell--hide-phone
					.demo-content.mdl-color--white.mdl-shadow--4dp.content.mdl-color-text--grey-800.mdl-cell.mdl-cell--8-col
						.row
							.col-md-8.center-block
								%h1
									= partial "partials/course-title"
								%h2 Course Description

								= partial "partials/course-description"
						.row
							- if current_page.data.course_sidebar_widgets
								- current_page.data.course_sidebar_widgets.each do |sidebar_widget|
									.col-md-4.center-block
										:markdown
											#{sidebar_widget}
						-files.each do |file|
							.row
								.col-md-8.center-block
									:markdown
										#{File.read(sitemap.find_resource_by_path(file).source_file).split(/^---$/)[-1]}
						.row
							.col-md-8.center-block
								:erb
									<%
										# As a rule, don't edit this file.
										#
										# If you need to change the course schedule, edit data/schedule.yml
										#
										# If you need to change the description, edit source/partials/_schedule-description.md
									%>
									<%= partial "partials/schedule-description" %>
									<%if data['schedule'].has_key? 'classes'
										today = data['schedule']['start']
										holiday_dates = data['schedule']['holidays'].map { |x| x['date'] }
										holiday_names = data['schedule']['holidays'].map { |x| x.has_key?('name') ? x['name'] : nil }
										current_meeting = 0
										current_day = 0
										current_week = 1
										current_unit = 1
	
										data_structure = {
		
										}
										catch (:done) do
											data['schedule']['meets'].each do |meeting|
												if today.strftime('%w').to_i < Chronic.parse(meeting).to_date.strftime('%w').to_i 
													today = Chronic.parse("next #{meeting}", :now => today).to_date
													throw :done
												elsif today.strftime('%w').to_i == Chronic.parse(meeting).to_date.strftime('%w').to_i 
													throw :done
												else
													if current_meeting == 0
														current_week += 1
													end
													current_meeting += 1
												end
											end
										end
	
										# Parse through the semester:
										while today <= data['schedule']['end'] + 1
											# Figure out the day content (either a holiday or out of the schedule):
											if holiday_dates.index(today).is_a? Integer
												day = "**No Class**\n\n#{if not holiday_names[holiday_dates.index(today)].nil? then '*' +  holiday_names[holiday_dates.index(today)] + '*' end}"
												data_structure[today.to_s] = day
											else
												data_structure[today.to_s] = nil
											end
											# Update the next meeting day:
											current_meeting += 1
		
											# If we're at the end of the week, close the .week div and reset to next week:
											if current_meeting == data['schedule']['meets'].length
												current_meeting = 0
											end
											# Generate the next day we will look at in the next iteration of the loop:
											today = Chronic.parse("next #{data['schedule']['meets'][current_meeting]}", :now => today).to_date
										end
										if data['schedule'].has_key? 'redefined'
											data['schedule']['redefined'].each do |redefined_day|
												if data['schedule']['meets'].index(redefined_day['is_a']) != nil
													data_structure[redefined_day['date'].to_s] = nil
												elsif data['schedule']['meets'].index(redefined_day['date'].strftime("%A").downcase) != nil and data['schedule']['meets'].index(redefined_day['is_a']) == nil
													data_structure[redefined_day['date'].to_s] = "**No Class**\n\n*Redefined Day (Go To #{redefined_day['is_a'].capitalize} Classes)*"
												end
											end
										end
									end
									%>
									<div class="schedule">
										<%
										current_meeting = 0
										current_week = 1
										current_unit = 1
										current_day = 0
	
										data_structure.keys.sort.each do |today|
											today = Chronic.parse(today)
											# Open a new week if we're at the start of the week:
											if current_meeting == 0
												if data['schedule'].has_key?('units') and data['schedule']['units'].index{ |a| a['start'] == current_week }%>
													<div class="week">
														<h2>Unit <%=current_unit%>: <%=data['schedule']['units'][data['schedule']['units'].index{ |a| a['start'] == current_week }]['title'] %></h2>
														<% if data['schedule']['units'][data['schedule']['units'].index{ |a| a['start'] == current_week }].has_key? 'description' %>
														<%= Tilt['markdown'].new(config[:markdown]) { data['schedule']['units'][data['schedule']['units'].index{ |a| a['start'] == current_week }]['description'] }.render(app) %>
														<%end%>
													</div>
												<% 
													current_unit += 1
												end %>
									<div class="mdl-grid">
										<h<%=data['schedule'].has_key?('units') ? 3 : 2%> class="mdl-cell mdl-cell--12-col schedule__week">Week <%= current_week%><% if data['schedule'].has_key? 'weeks' and data['schedule']['weeks'].has_key? current_week then%><small class="schedule__week-title"> <%= data['schedule']['weeks'][current_week]%></small><% end %></h<%=data['schedule'].has_key?('units') ? 3 : 2%>>
											<%
												current_week += 1
											end 
											# Create a new day and print the date:
											%>
										<div class="mdl-cell mdl-cell--<%=(12 / data['schedule']['meets'].length)%>-col">
											<p><strong><%=today.strftime('%a %m/%d')%></strong></p>
											<%
			
												# Figure out the day content (either a holiday or out of the schedule):
												if not data_structure[today.to_date.to_s].nil?
													day = data_structure[today.to_date.to_s]
												else
													day = data['schedule']['classes'][current_day]
													current_day += 1
												end
												if day.nil?
													day = ''
												end

											%>
											<%=  
												# Render the content of the day using Markdown:
												Tilt['markdown'].new(config[:markdown]) { day }.render(app) %>
										</div>
											<%
											# Update the next meeting day:
											current_meeting += 1
		
											# If we're at the end of the week, close the .week div and reset to next week:
											if current_meeting == data['schedule']['meets'].length%>
									</div>
											<%
												current_meeting = 0
											end
										end
										%>
									</div>
		%footer
